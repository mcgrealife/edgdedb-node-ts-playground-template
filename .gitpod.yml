# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/introduction/learn-gitpod/gitpod-yaml)
# and commit this file to your remote git repository to share the goodness with others.

# Learn more from ready-to-use templates: https://www.gitpod.io/docs/introduction/getting-started/quickstart

tasks:
# read "caveats". installs to /home/gitpod/.local/bin which is outside the /workspace/ and thus lost between workspace builds. recommend using before task or custom docker. trying before first.
  - name: install npm packages, install-edgedb-cli, initialize project, overwrite example schema, run migrations, open files
    before: |
      npm install
      curl --proto '=https' --tlsv1.2 -sSf https://sh.edgedb.com | sh -s -- -y -v
      edgedb project  init --server-instance=edgedb --non-interactive
    init: |
      edgedb project init --non-interactive
      mv default.esdl dbschema
    command:
      edgedb migration create --non-interactive && edgedb migration apply && npm run generate
      gp open dbschema/default.esdl
      gp open src/index.ts
      echo 'modify the schema in default.esdl, save, npm run migrate; then update the query builder in src/index.ts; npm run start to execute the query!  '
  # - name: reinstall CLI on restart; reinitialize project with link flag
  #   command: curl --proto '=https' --tlsv1.2 -sSf https://sh.edgedb.com | sh -s -- -y -v ; edgedb project  init --server-instance=edgedb --non-interactive
# vscode:
#   extensions:
#     - https://github.com/edgedb/edgedb-editor-plugin/issues/22 (schema syntax highlighting unavailable until VScode extension published to OpenVSX)

